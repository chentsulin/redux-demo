<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Redux Intro</title>

		<meta name="description" content="Redux Intro">
		<meta name="author" content="C. T. Lin">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="node_modules/prismjs/themes/prism.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<style>
.reveal pre code { max-height: 500px !important;}
a { color: white !important; text-decoration: underline !important;}
		</style>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section data-background="#b5533c">
					<p style="font-size: 3em">Redux</p>
					<p style="font-size: 1.1em">predictable state container</p>
					<p>
						<small><a href="https://github.com/chentsulin">C. T. Lin</a></small>
					</p>
				</section>

				<section data-transition="slide" data-background="#4d7e65">
					<section>
						<p style="font-size: 2em">MVC 有什麼問題？</p>
					</section>
					<section>
						<p>幾年前開始的 Client Side MVC 大戰</p>
						<img src="img/mvc-vs.png" style="background-color: #fff"/>
					</section>
					<section>
						<p style="font-size: 1.8em">UI move fast</p>
						<p style="font-size: 1.8em">MVC doesn't scale</p>
					</section>
					<section>
						<p>複雜度超過想像</p>
						<img src="img/mvc.png" />
					</section>
					<section>
						<p>詳細的可以參考這個影片：<br /><a href="https://www.youtube.com/watch?v=nYkdrAPrdcw" target="_blank">Rethinking Web App Development at Facebook</a></p>
					</section>
				</section>

				<section data-transition="slide" data-background="#b5533c">
					<section>
						<p style="text-align: left; color: #ee5">Managing complexity is the most important technical topic in software development. In my view, it’s so important that Software’s Primary Technical Imperative has to be managing complexity.</p>

						<p style="text-align: left">軟體首要技術使命是管理複雜度。</p>

						<p style="text-align: left"><span style="color: #ee5">– Steve McConnell in Code Complete</span> <a href="http://stackoverflow.com/questions/1711/what-is-the-single-most-influential-book-every-programmer-should-read" target="_blank">(most-influential-book-every-programmer-should-read)</a></p>

					</section>
					<section>
						<p>處理前端複雜架構的訣竅在於</p>
						<p style="font-size: 3em">提高可預測性</p>
						<p>這就是 React 的目標</p>
					</section>
					<section>
						<img src="img/react-flux.png" />
					</section>
				</section>

				<section data-transition="slide" data-background="#4d7e65">
					<section>
						<p style="font-size: 3em">Flux</p>
					</section>
					<section>
						<p>Unidirectional data flow</p>
						<img src="img/flux.png" />
					</section>
					<section>
						<img src="img/flux-explained.png" />
					</section>
				</section>

				<section data-transition="slide" data-background="#b5533c">
					<section>
						<p style="font-size: 2em">Flux 運作方式</p>
					</section>
					<section>
						<img src="img/flux-concept.png" />
					</section>
					<section>
						<p style="font-size: 1.8em">Classical Flux 的缺點</p>
						<br />
						<ul>
							<li>State Mutation</li>
							<li>Impure Reducer</li>
							<li>Singleton Issue</li>
							<li>Boilerplate</li>
						</ul>
					</section>
				</section>

				<section data-transition="slide" data-background="#4d7e65">
					<p style="font-size: 3em">Redux</p>
				</section>

				<section data-transition="slide" data-background="#b5533c">
					<section>
						<p>2015/5/30 First commit</p>
						<p>原本只是用來準備一個 React EU Conf 的 講題<br /><a href="https://www.youtube.com/watch?v=xsSnOQynTHs" target="_blank">Live React: Hot Reloading with Time Travel</a></p>
					</section>
					<section>
						<p>意外做出最受歡迎的 Flux 架構</p>
						<p>所以作者稱為 CDD (Conference Driven Development)</p>
					</section>
				</section>
				<section data-transition="slide" data-background="#4d7e65">
					<img src="img/redux-2.png" style="background-color: #fff" />
				</section>

				<section data-transition="slide" data-background="#b5533c">
                    <section>
                        <p style="font-size: 1.5em; color: #B2E1EA">Action</p>
                        <p>只是個普通的 JS Object</p>
                        <p>一定要有一個 type</p>
<pre><code class="lang-js">{
  type: SEND_MESSAGE,
  payload: {
    text: 'Hello world'
  }
}</code></pre>
						<p>把資料傳給 Store 的唯一手段</p>
                        <p>表達修改 State 的意圖</p>
                    </section>
                    <section>
                        <p style="font-size: 1.5em; color: #B2E1EA">Flux Standard Action</p>
                        <p><a href="https://github.com/acdlite/flux-standard-action" target="_blank">Flux Standard Action</a> 有一個普遍的 action 定義</p>
                        <p>包括 meta, error 等欄位</p>
                    </section>
                </section>

                <section data-transition="slide" data-background="#4d7e65">
                    <section>
                        <p style="font-size: 1.5em; color: #B2E1EA">Action Creators</p>
                        <p>通常寫在 XxxxActions 或 XxxxActionCreators 命名的檔案中</p>
                        <p>小心盡量不要跟 Action 搞混</p>
                    </section>
                    <section>
	                    <p>一個普通的 Action Creator</p>
	                    <p>就是製造 Action 的 Pure Function</p>

<pre><code class="lang-js">function sendMessage(text) {
  return {
    type: SEND_MESSAGE,
    payload: {
      text
    }
  };
}</code></pre>
                    </section>
                    <section>
                        <p>這樣的 Pure Function 很好測試</p>

<pre><code class="lang-js">expect(sendMessage('Hello')).to.deep.equal({
    type: SEND_MESSAGE,
    payload: {
      text: 'Hello'
    });
});</code></pre>
                    </section>
                    <section>
                        <p>實際 dispatch Action</p>

<pre><code class="lang-js">// 先不管 dispatch 從哪來
dispatch(sendMessage('Hello'));</code></pre>
                    </section>
                    <section>
                    	<p>使用</p>
                    	<p><a href="https://github.com/gaearon/redux-thunk" target="_blank">thunkMiddleware (redux-thunk)</a></p>
                    	<p><a href="https://github.com/acdlite/redux-promise" target="_blankredu">PromiseMiddleware (redux-promise)</a></p>
	                    <p>就可以延伸的 ActionCreator 的功能</p>
	                    <p>這邊先不做敘述</p>
                    </section>
                </section>

                <section data-transition="slide" data-background="#b5533c">
                    <section>
                        <p style="font-size: 1.5em; color: #B2E1EA">Reducer</p>
                        <p>給 Store 初始的 State</p>
                        <p>並根據收到的 Action 回傳新的 State</p>
                        <p>就像是原本的 Store 的一部分工作</p>
                    </section>
                    <section>
                        <p><code>(previousState, action) => newState</code></p>
                    </section>
                    <section>
                    <p>每次收到 dispatch 的 Action 就會觸發</p>
                    <p>根據原本的 previousState 和 Action，回傳新的 newState</p>
                    <p>這樣的 Functional 的做法</p>
                    <p>可以更簡潔的表達如何變更 State</p>
                    </section>
                    <section>
                    <p>這是個沒有 Side Effect 的 Function</p>
                    <p>不要去改 previousState</p>
                    <p>會使 Time Travel 等需要前面 State 的功能壞掉</p>

<pre><code class="lang-js">const initialState = { message: '' };

function messageReducer(state = initialState, action) {
  switch (action.type) {
    case SEND_MESSAGE:
      return {
        message: action.text
      };
    default:
      return state; // 沒有做任何事也要回傳原本的
  }
}</code></pre>
                    </section>

                    <section>
                    	<p>在一開始的時候 Redux 會 dispatch</p>
                    	<p><span style="color: #ee5"><code>@@redux/INIT</code></span> Action 來初始化 State</p>
                    </section>
                    <section>
                    	<p style="color: #ee5"><code>@@namespace/EVENT_NAME</code></p>
                    	<p>是目前 Private Event 的命名規範</p>
                    	<p>不要試圖去聽這些 Event</p>
                    </section>
                </section>


                <section data-transition="slide" data-background="#4d7e65">
                    <section>
                        <p style="font-size: 1.5em; color: #B2E1EA">Store</p>
                        <p>應用程式保存 State 的地方，Redux 只有一個</p>
                    </section>
                    <section>
                    	<p>建立 Store 的方式是把 reducer 傳進去 <code style="color: #ee5">createStore</code></p>

<pre><code class="lang-js">import { createStore } from 'redux';
import messageReducer from '../reducers/messages';
const store = createStore(messageReducer);
</code></pre>
                    </section>
                    <section>
                    	<p>實際會有很多不同資料的 reducer</p>
                    	<p>所以需要用 <code style="color: #ee5">combineReducers</code> 來結合他們</p>

<pre><code class="lang-js">// reducers/index.js
import { combineReducers } from 'redux';
import todos from './todos';
import counter from './counter';

export default combineReducers({
  todos,
  counter
});

// App.js
import { createStore } from 'redux';
import reducer from './reducers/index';

const store = createStore(reducer);
</code></pre>
                    </section>
                    <section>
                    	<p style="font-size: 1.5em; color: #B2E1EA">dispatch</p>

                    	<p>這是比較 Low-level 的 API</p>
                    	<p>不過還是值得一提，dispatch 其實在 store 上面</p>

                    	<p>雖然大部份時候並不會直接這樣寫</p>

<pre><code class="lang-js">store.dispatch(sendMessage('Hello'));
</code></pre>
                    </section>
                    <section>
                    	<p style="font-size: 1.5em; color: #B2E1EA">getState</p>

                    	<p>可以取得 store 現在的 state。</p>

<pre><code class="lang-js">store.getState();
</code></pre>
                    </section>
                </section>

                <section data-transition="slide" data-background="#b5533c">
                    <section>
                        <p style="font-size: 1.5em; color: #B2E1EA">Middleware</p>
                        <p>用來延伸 dispatch 的功能</p>
                    </section>
                    <section>
                    	<p>使用 <code style="color: #ee5">applyMiddleware</code> util</p>

<pre><code class="lang-js">import { createStore, applyMiddleware } from 'redux';

const store =
applyMiddleware(promise, thunk, observable)(createStore)(reducer);
// applyMiddleware 可以 Decorate createStore
</code></pre>
                    </section>
                    <section>
                        <p><code>dispatch => dispatch'</code></p>
                    </section>
                    <section>
                        <p>讓 dispatch 經過一個個的 Middleware Decorate</p>
<pre><code class="lang-js">const store =
applyMiddleware(promise, thunk, observable)(createStore)(reducer);
// store.dispatch => promise(thunk(observable(store.dispatch)));
</code></pre>
                    </section>
                    <section>
                    	<p><a href="https://github.com/gaearon/redux-thunk" target="_blank">redux-thunk</a> 這個 Middleware</p>

                    	<p>讓 Store 可以 dispatch Thunk</p>

<pre><code class="lang-js">function sendMessageAsync(message) {
  return dispatch => {
    setTimeout(() => {
      dispatch(sendMessage(message));
    }, 1000);
  };
}
</code></pre>
                    </section>
                    <section>
                    	<p><a href="https://github.com/acdlite/redux-promise" target="_blank">redux-promise</a> 這個 middleware</p>

                    	<p>讓 Store 可以 dispatch Promise</p>

<pre><code class="lang-js">function sendMessageAsync(message) {
  return dispatch => {
      dispatch(new Promise((resolve, reject)) => {
        setTimeout(() => {
            resolve(sendMessage(message))
        }, 1000);
      });
  };
}
</code></pre>
                    </section>
                    <section>
                    	<p>非同步的地方讓 ActionCreator 去做</p>
                    	<p>Reducer 是完全同步的</p>
                    </section>
                </section>

                <section data-transition="slide" data-background="#4d7e65">
                    <section>
                        <p style="font-size: 1.5em; color: #B2E1EA">View</p>
                        <p>Redux 本身並不依賴特定 View Layer</p>
                        <p>所以可以跟任何 View Layer 去結合</p>
                    </section>
                    <section>
                        <p><a href="https://github.com/gaearon/react-redux" target="_blank">react-redux</a> 就是 react 跟 redux 的介接</p>
                    </section>
                    <section>
                        <p>提供兩個東西：</p>
                        <ul>
                            <li>Provider</li>
                            <li>connect</li>
                        </ul>
                    </section>
                </section>


                <section data-transition="slide" data-background="#b5533c">
                    <section>
                        <p style="font-size: 2em">Provider</p>
                    </section>
                    <section>
                    	<p>Provider 用來在 RootComponent 外再包一層</p>
                    	<p>並把 Store 用 React Context 傳下去：</p>

<pre><code class="lang-js">&lt;Provider store={store}&gt;
  &lt;MyRootComponent&gt;
&lt;/Provider&gt;
</code></pre>
                    </section>
                </section>

                <section data-transition="slide" data-background="#4d7e65">
                    <section>
                        <p style="font-size: 2em">connect</p>
                    </section>
                    <section>
                    	<p>connect 用來</p>
                    	<p>把特定的 State 從 Context 裡的 Store Select 出來</p>
                    	<p>把 Event Handler 綁進來</p>
                    	<p>並它們當 props 傳下去：</p>

<pre><code class="lang-js">class MyComponent extends React.Component {
  render() {
    const { dispatch, user } = this.props;
    // connect 沒給第二個參數時 dispatch 會預設當 props 傳下來
    //..
  }
}

expect default connect(state => ({
  user: state.user
}))(MyComponent);
</code></pre>
                    </section>
                    <section>
<pre><code class="lang-js">// 也可以用 decorator 的寫法，不過官方不推薦..
@connect(state => ({
  user: state.user
}))
expect default class MyComponent extends React.Component {
  render() {
    const { dispatch, user } = this.props;
    //..
  }
}
</code></pre>
                    </section>
                </section>

                <section data-transition="slide" data-background="#b5533c">
                    <section>
                        <p style="font-size: 1.5em">bindActionCreators</p>
                        <p>Redux 還有一個可以方便去使用 ActionCreator 的 util</p>
                    </section>
                    <section>
                    	<p>把 dispatch 包進去：</p>

<pre><code class="lang-js">import { bindActionCreators } from 'redux';

@connect(state => ({
  user: state.user
}))
class MySmartComponent extends React.Component {

    render() {
        const { dispatch, user } = this.props;
        const actions = bindActionCreators(UserActions, dispatch);
        return (
            <MyDumbComponent user={user} {...actions}>
                {this.props.children}
            </MyDumbComponent>
        );
    }
}
</code></pre>
                    </section>
                </section>

                <section data-transition="slide" data-background="#4d7e65">
                    <section>
                        <p>connect (react-redux v0.8.0)</p>
                    </section>
                    <section>
                    <p>v0.8.0 的 connect 不需要再寫一個 Component，<br />

只要把要傳怎樣的 props 給搞定，<br />

	他會自動幫你包進 Connect Component</p>

<pre><code class="lang-js">function mapStateToProps(state) {
  return {
    user: state.user
  };
}

export default connect(mapStateToProps)(MyDumbComponent)
</code></pre>

更簡單了！
                    </section>
                    <section>
                    	<p>`connect` 現在有三個可選參數：`mapStateToProps`, `mapDispatchToProps`, `mergeProps`</p>
<ul>
	<li>mapStateToProps: 跟之前一樣，把 store state 的特定部分當成 props</li>
	<li>mapDispatchToProps: 把 dispatch 傳進去也變成 props，通常用來把 actionCreators 傳下去</li>
	<li>mergeProps: 可以指定 stateProps, dispatchProps, parentProps 的合併方式</li>
</ul>

					</section>
					<section>
<p>預設是這樣：</p>

<pre><code class="lang-js">const defaultMergeProps = (stateProps, dispatchProps, parentProps) => ({
  ...parentProps,
  ...stateProps,
  ...dispatchProps
});
</code></pre>
                    </section>
                    <section>
                    	<p>也傳遞包 dispatch 的 actionCreator props 下去：</p>

<pre><code class="lang-js">function mapStateToProps(state) {
  return {
    user: state.user
  };
}

function mapDispatchToProps(dispatch) {
  return {
    onSendMessage: () => dispatch(sendMessage())
  };
}

export default connect(
    mapStateToProps,
    mapDispatchToProps
)(MyDumbComponent)
</code></pre>
                    </section>
                    <section>
                    	<p>最後一個：</p>

<pre><code class="lang-js">function mergeProps(stateProps, dispatchProps, parentProps) {
  return {
    ...stateProps,
    ...dispatchProps,
    ...parentProps
  }
}

export default connect(
    mapStateToProps,
    mapDispatchToProps,
    mergeProps
)(MyDumbComponent)
</code></pre>

	<p>這樣就可以讓 parentProps 蓋掉其他兩個</p>
                    </section>
                </section>

                <section data-transition="slide" data-background="#b5533c">
                    <section>
                        <p>v0.8.0 也可以 bindActionCreators</p>
                    </section>
                    <section>
<pre><code class="lang-js">function mapStateToProps(state) {
  return {
    user: state.user
  };
}

function mapDispatchToProps(dispatch) {
  return bindActionCreators(UserActions, dispatch);
}

export default connect(
    mapStateToProps,
    mapDispatchToProps
)(MyDumbComponent)
</code></pre>
                    </section>
                </section>

				<section data-transition="slide" data-background="#4d7e65">
					<section>
						<p style="font-size: 1.5em">Redux 優點</p>
						<ol>
							<li>所有東西都 Hot Reloadable</li>
							<li>容易做 Universal，沒用到 Sigleton 而且資料可以 rehydrated</li>
							<li>可以用任何形式保存資料：JS Objects, Arrays, ImmutableJS..</li>
							<li>簡化至一個 Store</li>
							<li>提供 redux-devtools Time travel 功能</li>
							<li>可以用 Middleware 擴充 dispatch</li>
							<li>不用 Mock 就很容易測試</li>
						</ol>
					</section>
					<section>
						<p>而且他的 API 很少，核心只有 createStore 的 150 行程式碼</p>
						<img src="img/source.png" />
					</section>
					<section>
						<h2>容易學、好擴充</h2>
					</section>
				</section>

				<section data-transition="slide" data-background="#4d7e65" style="text-align: left;">
					<h1>THE END</h1>
					<p>Thanks for listening</p>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				slideNumber: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'node_modules/prismjs/prism.js'},
                    { src: 'node_modules/prismjs/components/prism-bash.min.js'},
                    { src: 'node_modules/prismjs/plugins/autolinker/prism-autolinker.min.js'},
                    { src: 'node_modules/prismjs/components/prism-javascript.min.js', async: true, callback: function() {
                    		Prism.highlightAll();
                    	}
                    },
                    { src: 'node_modules/prismjs/components/prism-bash.min.js', async: true, callback: function() {
                    		Prism.highlightAll();
                    	}
                    },
                    { src: 'node_modules/prismjs/components/prism-ruby.min.js', async: true, callback: function() {
                    		Prism.highlightAll();
                    	}
                    },
					// { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() {
					// 	hljs.initHighlightingOnLoad(); }
					// },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});
		</script>

	</body>
</html>
